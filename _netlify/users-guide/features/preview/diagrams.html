<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Diagrams in the preview :: Project Aris</title>
    <link rel="canonical" href="https://docs.waxc.tech/users-guide/features/preview/diagrams.html">
    <link rel="prev" href="../preview.html">
    <link rel="next" href="javafx-preview.html">
    <meta name="description" content="The preview of the AsciiDoc plugin supports rendering the diagrams in the preview. It supports both the Asciidoctor Diagram and the Kroki plugin.">
    <meta name="generator" content="Antora 3.1.3">
<!-- https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="../../../antora/css/site.css">
<link rel="stylesheet" href="../../../antora/css/search.css">
<link rel="stylesheet" href="../../../antora/css/custom.css">
<link rel="stylesheet" href="../../../antora/css/font-awesome.min.css">
    <script>var uiRootPath = '../../../antora'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/"><img src="/assets/images/ad-logo.svg" height="40" width="40" class="logo" style="margin-right: 0.55rem" alt=""> Project Aris</a>
            <div class="navbar-item search hide-for-print">
                <div id="search-field" class="field has-filter">
                    <input id="search-input" type="text" placeholder="Search the docs">
                        <input checked style="display: none" type="checkbox" data-facet-filter="component:users-guide">
                </div>
            </div>
        <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <a href="/docs/users-guide/quick-start.html">Quick-Start</a>
        </div>
          <div class="navbar-item">
              <a href="/docs/users-guide/index.html">User’s Guide</a>
          </div>
          <div class="navbar-item">
              <a href="/docs/contributors-guide/index.html">Contributor’s Guide</a>
          </div>
        <div class="navbar-item">
          <a href="/docs/users-guide/faq.html">FAQ</a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="users-guide" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">User’s Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item is-current-path is-active" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../quick-start.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../installation.html">Installing the plugin</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../technical-writing/index.html">Setup for technical writing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/installing-intellij.html">Installing IntelliJ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/starting-intellij-first-time.html">Starting IntelliJ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/opening-the-first-project.html">Opening a project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/editing-an-asciidoc-file.html">Editing an AsciiDoc file</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/navigating-in-a-project.html">Navigating in a project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/searching-in-a-project.html">Searching in a project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/learning-asciidoc-syntax.html">Learning AsciiDoc syntax</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/using-tables-in-a-project.html">Using tables in AsciiDoc</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/git-integration.html">Collaborate using Git</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/preparing-a-repository.html">Preparing a repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/using-antora-with-intellij.html">Using Antora with IntelliJ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/recommended-plugins.html">Recommended Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../technical-writing/getting-help.html">Getting help</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../antora/index.html">Decisions around Antora</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../antora/how-many-repositories.html">Structuring Antora repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../antora/generated-content-in-antora.html">Generated content and attachments</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../recommended-settings.html">Configuring the plugin</a>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../features.html">Plugin&#8217;s Features</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../editor.html">Editing Content</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../keymap.html">Using Hotkeys</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../search.html">Searching content</a>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../preview.html">Previewing content</a>
<ul class="nav-list">
  <li class="nav-item is-current-page is-active" data-depth="3">
    <a class="nav-link" href="diagrams.html">Diagrams in the preview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="javafx-preview.html">JavaFX Preview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="jcef-preview.html">JCEF Preview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="source-highlighting.html">Highlighting source code</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/asciidoclet.html">Asciidoclet</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/asciidoctorconfig-file.html">Asciidoctor Config File</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/asciidoctor-extensions.html">Asciidoctor Extensions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/conditional-rendering.html">Conditional Rendering</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/stylesheets.html">Custom stylesheets</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/creating-docx.html">Creating DOCX</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/creating-html.html">Creating HTML</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/creating-pdf.html">Creating PDF</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/frontmatter.html">Front matter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/grammar-checking.html">Checking the Grammar</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/livetemplates.html">Live Templates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/multimodule.html">Multi-module Projects</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/validation-in-ide.html">Validation in the IDE</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/validation-cicd.html">Validation in CI/CD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/pdf-non-latin-languages.html">PDFs with non-latin fonts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/privacy.html">Privacy for users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/reformatting.html">Reformatting Content</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/spring-rest-docs.html">Spring REST Docs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/antora.html">Working with Antora</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../advanced/hugo.html">Working with Hugo</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../faq.html">Frequently asked questions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/indent-missing-on-pasting.html">Indent missing when pasting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/jcef-no-proxy-support.html">Proxy issues JCEF preview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/javafx-initialization-stuck.html">JavaFX initialization stuck</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/validation-for-asciidoc-files.html">Validation of files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/blurry-preview.html">JavaFX blurry preview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/errno-enoent.html">Error Message ENOENT</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/troubleshooting-mps.html">Troubleshooting MPS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/diagrams-in-pdf-without-text.html">Problems with Diagrams in PDFs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../faq/could-not-find-dot-executable.html">Could not render diagrams with external helpers</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">User’s Guide</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../body-of-knowledge/index.html">Body of Knowledge</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../body-of-knowledge/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../contributors-guide/index.html">Contributor’s Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../contributors-guide/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../index.html">User’s Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../body-of-knowledge/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">User’s Guide</a></li>
    <li><a href="../../features.html">Plugin&#8217;s Features</a></li>
    <li><a href="../preview.html">Previewing content</a></li>
    <li><a href="diagrams.html">Diagrams in the preview</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/mac/Repo/aris/antora/doc/users-guide/modules/ROOT/pages/features/preview/diagrams.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Diagrams in the preview</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The preview of the AsciiDoc plugin supports rendering the diagrams in the preview.
Two different types of diagram renderer are supported: <a href="#asciidoctor-diagram">Asciidoctor Diagram</a> and &lt;&lt;&gt;&gt;.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="asciidoctor-diagram"><a class="anchor" href="#asciidoctor-diagram"></a>Using Asciidoctor Diagram</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the plugin uses the extension <a href="https://github.com/asciidoctor/asciidoctor-diagram">Asciidoctor Diagram</a>
that depends on locally installed tools to generate images (i.e. <a href="https://github.com/asciidoctor/asciidoctor-diagram#specifying-diagram-generator-paths">executables</a> available in the <code>PATH</code> environment variable).</p>
</div>
<div class="paragraph">
<p>The extension Asciidoctor Diagram renders the content of the editor, including all referenced includes, images and diagrams like PlantUML on the fly.</p>
</div>
<div class="sect2">
<h3 id="downloading-asciidoctor-diagram"><a class="anchor" href="#downloading-asciidoctor-diagram"></a>Downloading Asciidoctor Diagram</h3>
<div class="paragraph">
<p>As of the AsciiDoc Plugin version 0.31.14+, Asciidoctor Diagram is no longer included in the plugin as default as it adds approximately 15 MB to the download of the installation and each update.</p>
</div>
<div class="paragraph">
<p>When the preview includes a diagram, the plugin shows an editor notification asking the user to download the necessary dependency.</p>
</div>
<div class="paragraph">
<p>The download requires a working internet connection.
When the download fails, the IDE prompts to check proxy settings or to retry the download.
The IDE&#8217;s event log contains instructions for a manual download of the file.</p>
</div>
<div class="paragraph">
<p>The dependencies will be cached locally.
A new download will only be necessary when the AsciiDoc plugin requires a newer version.</p>
</div>
<div class="paragraph">
<p>Users can force the download by selecting &#8220;Download AsciiDoc dependencies for diagrams and PDF creation&#8221; in the settings of the plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="temp-folder-asciidoctor"><a class="anchor" href="#temp-folder-asciidoctor"></a>Temporary folder <em>.asciidoctor</em> appearing in several places</h3>
<div class="paragraph">
<p>This is a folder that holds temporary files that are created, for example, for dynamic diagrams.</p>
</div>
<div class="paragraph">
<p>When running in Asciidoctor&#8217;s UNSAFE mode, the plugin creates a temporary folder outside the project.
When running in any other mode, Asciidoctor needs to have this folder them relative to the document&#8217;s folder.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Diagrams in the preview when running in any mode other than UNSAFE will only work starting with version 0.33.8.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To avoid checking in these files, consider adding a file path to the ignore file of your version control system.</p>
</div>
<div class="paragraph">
<p>See below for a <em>.gitignore</em> file placed in the root of the project if the project uses Git as its version control system.</p>
</div>
<div class="listingblock">
<div class="title">.gitignore</div>
<div class="content">
<pre>**/.asciidoctor/images/*
**/.asciidoctor/diagram/*</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kroki"><a class="anchor" href="#kroki"></a>Using Kroki</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alternatively, the plugin supports <a href="https://kroki.io">Kroki</a> instead of Asciidoctor Diagram to render diagrams.</p>
</div>
<div class="paragraph">
<p>Use the plugin&#8217;s settings to enable Kroki:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../_images/kroki-settings.png" alt="kroki settings">
</div>
</div>
<div class="paragraph">
<p>When Kroki is enabled, the plugin sends the text diagrams to an instance of Kroki to display them as images in the preview.
By default, it sends the diagrams to the free public cloud instance <a href="https://kroki.io">kroki.io</a>, but users can install Kroki on their own infrastructure.
Once the custom instance is set up, update the server URL in the plugin&#8217;s settings to point to it.</p>
</div>
<div class="sect2">
<h3 id="creating-pdfs-with-kroki-diagrams"><a class="anchor" href="#creating-pdfs-with-kroki-diagrams"></a>Creating PDFs with Kroki diagrams</h3>
<div class="paragraph">
<p>In order for Kroki to embed diagrams in the PDF, the attribute <code>allow-uri-read</code> needs to be set in the plugin&#8217;s configuration.
This allows Asciidoctor to retrieve the diagram and embed it in the PDF.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting with plugin release 0.38.13 the attribute is set automatically once Kroki for diagrams has been enabled and the plugin is running in the default UNSAFE mode.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="inline-diagrams-with-kroki"><a class="anchor" href="#inline-diagrams-with-kroki"></a>Inline diagrams with Kroki</h3>
<div class="paragraph">
<p>When using the diagram option <code>inline</code>, users will need to set the attribute <code>allow-uri-read</code> in the plugin&#8217;s settings to allow the download of the diagrams at render time.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As Kroki will in inline-mode fetch the diagrams synchronously while preparing the preview, a slow or unavailable internet connection to the user&#8217;s Kroki server can slow down or break the preview.</p>
</div>
<div class="paragraph">
<p>To avoid this, consider using <code>interactive</code> for Kroki diagrams as an alternative.
See <a href="#interative-vs-inlined">Interactive vs inlined SVGs</a> and <a href="#avoid-flicker">Avoid flicker in preview on refresh</a> for a discussion of tradeoffs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-embedded-mermaid-support"><a class="anchor" href="#using-embedded-mermaid-support"></a>Using embedded Mermaid support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an experimental option in plugin version 0.38.1+, there&#8217;s an embedded Mermaid support that is embedded in the plugin and will render Mermaid diagrams within the IDE without external helpers.</p>
</div>
<div class="paragraph">
<p>To enable the support, toggle the checkbox <b class="menuref">Enable built-in Mermaid Diagrams support</b> in the plugin&#8217;s settings.</p>
</div>
<div class="paragraph">
<p>This is currently only supported for Mermaid diagrams, and only for the JCEF preview.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-options"><a class="anchor" href="#advanced-options"></a>Advanced options</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="png-only-javafx-preview"><a class="anchor" href="#png-only-javafx-preview"></a>PNG-only JavaFX preview</h3>
<div class="paragraph">
<p>JavaFX has a problem displaying SVG files correctly.
Therefore, the plugin displays all diagrams in the JavaFX preview as PNGs even when the user specifies SVG as the diagram format.</p>
</div>
<div class="paragraph">
<p>When using IntelliJ 2020.2+ and plugin version 0.31.25+, the JCEF preview will show diagrams as SVGs when the user specifies SVG as the diagram format.</p>
</div>
</div>
<div class="sect2">
<h3 id="interative-vs-inlined"><a class="anchor" href="#interative-vs-inlined"></a>Interactive vs inlined SVGs</h3>
<div class="paragraph">
<p>SVGs support interactions with the user such as hovering or links.
This is only available when the user adds the option <code>interactive</code> or <code>inline</code> to diagrams or SVG images.
Only when an SVG or diagram is inlined, the plugin will redirect clicks on links in the preview to local AsciiDoc files.
See <a href="https://asciidoctor.org/docs/user-manual/#taming-svgs">section &#8220;Taming SVGs&#8221; in the Asciidoctor manual</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>When using existing SVGs images in Asciidoctor, use <code><strong>opts=</strong>inline</code> to inline existing SVGs</p>
</li>
<li>
<p>When using Kroki, use <code><strong>opts=</strong>inline</code> and set <code>allow-uri-read</code> in the plugin&#8217;s settings</p>
</li>
<li>
<p>When using Asciidoctor Diagram, use <code><strong>svg-type=</strong>inline</code> to inline generated SVG</p>
</li>
<li>
<p>As this requires SVG support in the preview, this only works with the JCEF preview.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following PlantUML example renders a diagram in the preview showing a note &#8220;Link to class-demo.adoc&#8221; with a link.
When the user clicks on the note, the plugin resolves the link <code>class-demo.html</code> to the workspace file <code>class-demo.adoc</code>.</p>
</div>
<div class="listingblock">
<div class="title">Source code for diagram</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc"><span class="hljs-comment">// setting both opts and svg-type to make it work with both the Kroki plugin and the Asciidoctor Diagram plugin</span>
<span class="hljs-meta">[plantuml,demo,svg,opts=&quot;inline&quot;,svg-type=&quot;inline&quot;]</span>
<span class="hljs-code">----
class Demo
note right
[[class-demo.html Link to class-demo.adoc]]
end note
----</span></code></pre>
</div>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="../../_images/demo-735eb321366c52afa8e438c1ce38d146665faa1e.svg" alt="Diagram as displayed in the preview">
</div>
<div class="title">Figure 1. Diagram as displayed in the preview</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this documentation the image above is non-interactive, as the target link of the note would not resolve.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-extensions-to-create-links"><a class="anchor" href="#using-extensions-to-create-links"></a>Using extensions to create links</h3>
<div class="paragraph">
<p>An extension with custom inline macro can create the links from an <code>xref:[]</code>.
Use the JavaScript extension for example with Antora, and use the Ruby extension for IntelliJ as described in <a href="../advanced/asciidoctor-extensions.html" class="xref page">Asciidoctor Extensions</a>.</p>
</div>
<div class="listingblock">
<div class="title">JavaScript extension to add a custom inline macro <code>linkinpuml:...[]</code></div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">register</span> (registry, context) {
  registry.<span class="hljs-title function_">inlineMacro</span>(<span class="hljs-string">&#x27;linkinpuml&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">matchFormat</span>(<span class="hljs-string">&#x27;short&#x27;</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">positionalAttributes</span>([<span class="hljs-string">&#x27;content&#x27;</span>])
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">process</span>(<span class="hljs-function">(<span class="hljs-params">parent, target, attrs</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> anchor = parent.<span class="hljs-title function_">applySubstitutions</span>(attrs.<span class="hljs-property">content</span>, [<span class="hljs-string">&#x27;macros&#x27;</span>])
      <span class="hljs-keyword">const</span> [_, href, text] = anchor.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^&lt;a href=&quot;(.+?)&quot;[^&gt;]*&gt;(.*)&lt;\/a&gt;$/</span>)
      <span class="hljs-keyword">const</span> prefix = attrs.<span class="hljs-property">prefix</span>
      <span class="hljs-keyword">return</span> <span class="hljs-string">`[[<span class="hljs-subst">${prefix ? [prefix, href].join(<span class="hljs-string">&#x27;/&#x27;</span>) : href}</span> <span class="hljs-subst">${text}</span>]]`</span>
    })
  })
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">register</span> = register</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ruby extension to add a custom inline macro <code>linkinpuml:...[]</code></div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;asciidoctor/extensions&#x27;</span> <span class="hljs-keyword">unless</span> RUBY_ENGINE == <span class="hljs-string">&#x27;opal&#x27;</span>

<span class="hljs-keyword">include</span> <span class="hljs-symbol">:</span><span class="hljs-symbol">:Asciidoctor</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LinkInPumlMacro</span> &lt; Extensions::InlineMacroProcessor</span>
  use_dsl
  named <span class="hljs-symbol">:<span class="hljs-string">&#x27;link-in-puml&#x27;</span></span>

  def process parent, target, attrs

    anchor = parent.apply_subs(<span class="hljs-string">&quot;xref:<span class="hljs-subst">#{target}</span>[]&quot;</span>, [<span class="hljs-symbol">:macros</span>])

    <span class="hljs-comment"># parse the anchor</span>
    matches = anchor.match(<span class="hljs-regexp">%r{^&lt;a href=&quot;(?&lt;href&gt;.+?)&quot;[^&gt;]*&gt;(?&lt;text&gt;.*)&lt;/a&gt;$}</span>)

    <span class="hljs-keyword">if</span> matches
      <span class="hljs-comment"># matched, output the href</span>
      create_inline(parent, <span class="hljs-symbol">:quoted</span>, matches[<span class="hljs-symbol">:href</span>])
    <span class="hljs-keyword">else</span>
      <span class="hljs-comment"># no match, output the target as-is</span>
      create_inline(parent, <span class="hljs-symbol">:quoted</span>, target)
    <span class="hljs-keyword">end</span>

  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example PlantUML code which substitutes the macro to create a link</div>
<div class="content">
<pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc"><span class="hljs-meta">[plantuml, format=svg, opts=&quot;inline&quot;,subs=+macros]</span>
<span class="hljs-code">....
!include &lt;C4/C4_Container&gt;

System(systemAlias, &quot;Label&quot;, &quot;Optional Description&quot;, $link=&quot;linkinpuml:target.adoc[]&quot;)
....</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="avoid-flicker"><a class="anchor" href="#avoid-flicker"></a>Avoid flicker in preview on refresh</h3>
<div class="paragraph">
<p>Using inlined diagrams instead of interactive diagrams in the preview prevents flickering on refreshed content.
If inlining should be used only for IntelliJ preview, consider a conditional attribute like in the following listing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-plantuml" data-lang="plantuml">ifdef::env-idea[:plantuml-opts: inline]

// setting both opts and svg-type to make it work with both Kroki and Asciidoctor Diagram
[plantuml,demo,svg,opts="{plantuml-opts}",svg-type="{plantuml-opts}"]
----
...
----</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../preview.html">Previewing content</a></span>
  <span class="next"><a href="javafx-preview.html">JavaFX Preview</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <p>This page was built using <a href="https://antora.org/" rel="nofollow">Antora</a> - © 2023 WAXC Tech. Released under the Apache License, Version 2.0 - <a href="https://github.com/asciidoctor/asciidoctor-intellij-plugin" rel="nofollow">GitHub</a> - <a href="/imprint" rel="nofollow">Imprint</a> - <a href="/privacy" rel="nofollow">Privacy</a></p>
</footer>
<div id="myModal" class="modal">
    <span class="close cursor" onclick="closeModal()">&times;</span>
    <div class="modal-content" onclick="closeModal()">
        <!--suppress HtmlRequiredAltAttribute as this will be set when selecting the image via JavaScript,
        RequiredAttributes as src will be set by when selecting the image via JavaScript -->
        <img id="imageinmodal">
    </div>
</div>
<script>
    function openModal() {
        document.getElementById("myModal").style.display = "block";
        // use overflowY = hidden to prevent the body from scrolling when modal is visible
        // doesn't work with overscroll-behavior, as this would work only when the modal has a scrollbar
        document.getElementsByTagName("body")[0].style.overflowY = "hidden";
    }

    function closeModal() {
        document.getElementById("myModal").style.display = "none";
        document.getElementsByTagName("body")[0].style.overflowY = "auto";
    }

    document.querySelectorAll('.imageblock img').forEach(element => {
        if (element.closest('a') === null) {
            element.className += " lightbox";
            element.addEventListener('click', evt => {
                document.getElementById("imageinmodal").setAttribute("src", evt.currentTarget.getAttribute("src"))
                document.getElementById("imageinmodal").setAttribute("alt", evt.currentTarget.getAttribute("alt"))
                openModal();
            })
        }
    });
</script>
<style>
    /* The Modal (background) */
    .modal {
        display: none;
        position: fixed;
        z-index: 10;
        padding-top: 5vh;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        backdrop-filter: blur(3px);
        background-color: rgba(30, 30, 30, 0.8);
    }
    img.lightbox {
        cursor: pointer;
    }
    /* Modal Content */
    .modal-content {
        position: relative;
        margin: auto;
        padding: 0;
        width: 90%;
        max-height: 90vh;
        cursor: pointer;
    }

    .modal-content img {
        width: auto;
        height: auto;
        max-width: 90vw;
        max-height: 90vh;
        min-width: 90vw;
        min-height: 90vh;
        display: block;
        margin-right: auto;
        margin-left: auto;
        object-fit: contain;
    }

    /* The Close Button */
    .close {
        color: white;
        position: absolute;
        top: 10px;
        right: 25px;
        font-size: 35px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #999;
        text-decoration: none;
        cursor: pointer;
    }
</style>
<script src="../../../antora/js/os-switcher.js"></script>
<script>
    const navbarEl = document.getElementsByClassName("navbar")[0]
    const toolbarEl = document.getElementsByClassName("toolbar")[0]
    let NAVBAR_HEIGHT
    let horizon
    let scrollFactor = 0
    let whereYouStoppedScrolling = 0
    let currentTranslate = 0
    let currentStyle = ""

    function upOrDown(lastY, currentY) {
        if (currentY >= lastY) {
            return goingDown(currentY)
        }
        return goingUp(currentY)
    }

    function goingDown(currentY) {
        whereYouStoppedScrolling = currentY

        if (currentY > horizon) {
            horizon = currentY
        }

        translateHeader(currentY, false)
    }

    function goingUp(currentY) {
        if (currentY < whereYouStoppedScrolling - NAVBAR_HEIGHT) {
            horizon = currentY + NAVBAR_HEIGHT
        }

        translateHeader(currentY, true)
    }

    function constrainDelta(delta) {
        return Math.max(0, Math.min(delta, NAVBAR_HEIGHT))
    }

    function translateHeader(currentY, upwards) {
        let translateValue

        // if I have scrolled down sufficiently, the navbar appears faster
        if (currentY > NAVBAR_HEIGHT * 2) {
            scrollFactor = 1
        } else if (currentY > NAVBAR_HEIGHT) {
            scrollFactor = (currentY - NAVBAR_HEIGHT) / NAVBAR_HEIGHT
        } else {
            scrollFactor = 0
        }

        if (upwards && currentTranslate === 0) {
            translateValue = 0
        } else {
            const delta = constrainDelta(
                    Math.abs(currentY - horizon) * (1 + scrollFactor)
            )
            translateValue = delta - NAVBAR_HEIGHT
        }

        if (window.innerWidth > 1024) {
            translateValue = 0
        } else if (document.getElementsByClassName("nav-container")[0].classList.contains("is-active")) {
            translateValue = 0
        }

        if (!isNaN(translateValue)) {
            let navbarStyle = `transition: transform 0.5s ease-out; transform: translateY(${translateValue}px);`
            if (translateValue === -NAVBAR_HEIGHT) {
                navbarStyle = `transition: transform 0.5s ease-out; transform: translateY(${translateValue}px);`
            }
            if (currentY <= NAVBAR_HEIGHT) {
                navbarStyle = `transform: translateY(${translateValue}px);`
            }
            currentTranslate = translateValue
            if (currentStyle !== navbarStyle) {
                currentStyle = navbarStyle
                navbarEl.setAttribute("style", navbarStyle)
                toolbarEl.setAttribute("style", navbarStyle)
            }
        }
    }

    translateHeader(window.scrollY, false)

    let ticking = false
    let lastY = 0

    window.addEventListener("scroll", function () {
        if (NAVBAR_HEIGHT === undefined) {
            // lazy initialization on first scroll
            NAVBAR_HEIGHT =
                    parseInt(window.getComputedStyle(navbarEl).height.replace("px", "")) +
                    1
            horizon = NAVBAR_HEIGHT
        }
        const currentY = window.scrollY

        if (!ticking && window.requestAnimationFrame) {
            window.requestAnimationFrame(function () {
                upOrDown(lastY, currentY)
                ticking = false
                lastY = currentY
            })
        }

        ticking = true
    })

    window.addEventListener('resize', function () {
        NAVBAR_HEIGHT = undefined
        const currentY = 0
        upOrDown(lastY, currentY)
        lastY = currentY
        return true
    })


    document.getElementsByClassName("nav-toggle")[0].addEventListener("click", function () {
        const currentY = 0
        upOrDown(lastY, currentY)
        lastY = currentY
        return true
    })

</script>
<script>
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/users-guide/features/preview/diagrams.html'
</script>
<script src="../../../antora/js/site.js"></script>
<script src="../../../antora/js/vendor/lunr.js"></script>
<script src="../../../antora/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../antora/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
